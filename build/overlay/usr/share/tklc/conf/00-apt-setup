#!/bin/bash
set -exuo pipefail

# use cacher if available
[[ -z "${APT_CACHER-}" ]] || {
    echo "Acquire::http { Proxy \"${APT_CACHER}\"; };" >> /etc/apt/apt.conf.d/cacher;
}

# make noninteractive the default frontend and critical the lowest priority to show
echo 'debconf debconf/frontend select noninteractive' | debconf-set-selections
echo 'debconf debconf/priority select critical' | debconf-set-selections

# disable alternatives
dpkg-divert --add --local --rename --divert /usr/bin/update-alternatives.defunct /usr/bin/update-alternatives
ln -sf /bin/true /usr/bin/update-alternatives

# update so that following confs can count on the package tree being there
apt-get update

# this is needed for literally everything
apt-get install ca-certificates curl

